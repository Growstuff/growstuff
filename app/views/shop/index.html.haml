-content_for :title, 'Shop'

%p
  Growstuff relies on your support to build and run this open source
  platform for food growers.

%p
  We offer paid accounts which have access to exclusive features.  You can
  buy a monthly, yearly, or permanent ("seed") account.

%p
  All our accounts are priced on a sliding scale.  You can choose how much
  you want to pay.  Remember, your subscription supports an open source
  platform promoting sustainable lifestyles!

- if current_member && current_member.is_paid?
  %h2 Thank you for supporting Growstuff

  %p You currently have a paid membership, and can't buy another one at this time.

- elsif @order and @order.order_items.count > 0
  %h2 Your current order

  %p
    You currently have the following item in your cart:
    %strong
      = @most_recent_item.product
      @
      = price_with_currency(@most_recent_item.price)

  %p
    = link_to "View order and checkout", order_path(@order)
    or
    =succeed "." do
      = link_to 'delete this order', @order, method: :delete, |
        data: { confirm: 'Are you sure?' }

- else
  - @products.each do |p|
    %h2= p.name

    %div
      :markdown
        #{ strip_tags p.description }

    %p
      Pay what you want, starting at
      =succeed "." do
        =price_with_currency(p.min_price)

    %div
      - if can? :create, Order

        = form_for @order_item do |f|
          .field
            = f.text_field :price, :value => price_in_dollars(p.min_price)
          .field
            = f.hidden_field :product_id, :value => p.id
          .field
            = f.hidden_field :quantity, :value => 1
          .actions
            = f.submit 'Buy', :class => 'btn btn-primary'

      - else
        Please
        =link_to "sign in", new_member_session_path
        or
        =link_to "sign up", new_member_registration_path
        to purchase.


